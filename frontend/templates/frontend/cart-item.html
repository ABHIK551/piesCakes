<div class="container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <span>Home ></span> <span class="active">Cart</span>
    </nav>

    <!-- Cart Section -->
    <section class="cart">
        <style>
            .table-scroll-wrapper {
                overflow-x: auto !important;
                display: block !important;
                width: 100% !important;
                -webkit-overflow-scrolling: touch !important; /* Smooth scrolling on iOS */
                }
    
                .cart-table {
                min-width: 800px !important; /* Adjust to trigger horizontal scroll if content overflows */
                width: 100% !important;
                border-collapse: collapse !important;
                }
    
          </style>
        <div class="cart-items">
            <div class="table-scroll-wrapper">
                <table class="cart-table" id="cart-table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Item Price</th>
                            <th>Discount</th>
                            <th>Quantity</th>
                            <th>Total</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="cart-table-body">
                        
                    </tbody>
                </table>
            </div>
            
            <div class="shop-more">
                <a href="/" style="float: left;margin: auto 0%;">Continue Shopping</a>
                <button class="checkout" style="width: 200px;float: right;">Check Out</button>
            </div>
        </div>

        <!-- Summary Section -->
        <div class="summary">
            <h2>Summary</h2>
            <p>Estimate Shipping</p>
            <form>
                <label>City *</label>
                <select>
                    <option value="">Select City</option>
                    <option>Ranchi</option>
                    <option>Jamshedpur</option>
                    <option>Dhanbad</option>
                    <option>Bokaro</option>
                    <option>Hazaribagh</option>
                    <option>Deoghar</option>
                    <option>Giridih</option>
                    <option>Ramgarh</option>
                    <option>Palamu</option>
                    <option>Chaibasa</option>
                </select>
            
                <label>Location</label>
                <select>
                    <option>Choose Location</option>
                </select>
            
                <label>Zip/Postal Code</label>
                <input type="text" placeholder="Zip/Postal Code">
            </form>
            
            <div class="cost">
                <p>Sub-Total: <span>₹965.00</span></p>
                <p>Delivery Charges: <span>₹0.00</span></p>
                <p>Coupon Discount: <a href="#">Apply Discount</a></p>
            </div>
            <h3>Total Amount: ₹965.00</h3>
        </div>
    </section>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const token = sessionStorage.getItem("auth_token");
    
        const userId = sessionStorage.getItem("user_id");
        const cartTableBody = document.querySelector("#cart-table-body");
    
        fetch(`/api/view-cart/${userId}/`, {
            method: "GET",
        })
        .then(response => {
        })
        .then(data => {
            
            if (!data || !data.products || data.products.length === 0) {
                cartTableBody.innerHTML = `<tr><td colspan="6">Your cart is empty.</td></tr>`;
                sessionStorage.setItem("cart_count", "0");
                return;
            }
    
            let totalAmount = 0;
            cartTableBody.innerHTML = "";
    
            data.products.forEach(product => {
                const price = parseFloat(product.price);
                const discount_price = parseFloat(product.discount_price);
                const quantity = 1;
                const total = price * quantity;
                totalAmount += total;
    
                const imageSrc = product.product_images_base64_output
                    ? `data:image/jpeg;base64,${product.product_images_base64_output}`
                    : 'default.jpg';
    
                const rowHTML = `
                    <tr>
                        <td>
                            <img src="${imageSrc}" alt="${product.name}" class="product-img">
                            <span>${product.name}</span>
                        </td>
                        <td>₹${price.toFixed(2)}</td>
                        <td>₹${discount_price.toFixed(2)}</td>
                        <td class="quantity">
                            <button class="qty-btn minusQtyBTN">-</button>
                            <span class="quantityControl">${quantity}</span>
                            <button class="qty-btn addQtyBTN">+</button>
                        </td>
                        <td>₹${total.toFixed(2)}</td>
                        <td><button class="remove"><i class="fas fa-trash"></i></button></td>
                    </tr>
                `;
    
                cartTableBody.insertAdjacentHTML("beforeend", rowHTML);
                const scrollWrapper = document.querySelector(".table-scroll-wrapper");
                scrollWrapper.style.display = 'none';
                scrollWrapper.offsetHeight; // trigger reflow
                scrollWrapper.style.display = '';
            });
    
            sessionStorage.setItem("cart_count", data.products.length.toString());
    
            document.querySelector(".cost span").textContent = `₹${totalAmount.toFixed(2)}`;
            document.querySelector("h3").textContent = `Total Amount: ₹${totalAmount.toFixed(2)}`;
    
            attachQuantityHandlers();
            updateTotalAmount();
        })
        .catch(error => {
            console.error("Error loading cart:", error);
            cartTableBody.innerHTML = `<tr><td colspan="6">Failed to load cart items.</td></tr>`;
        });
    });
    </script>
    
<script>
function attachQuantityHandlers() {
  document.querySelectorAll(".cart-table tbody tr").forEach(row => {
    const minusBtn     = row.querySelector(".minusQtyBTN");
    const plusBtn      = row.querySelector(".addQtyBTN");
    const quantitySpan = row.querySelector(".quantityControl");
    const priceTd      = row.children[1];  // Item Price
    const totalTd      = row.children[4];  // Total

    if (!minusBtn || !plusBtn || !quantitySpan || !priceTd || !totalTd) return;

    const unitPrice = parseFloat(priceTd.textContent.replace("₹", ""));
    let quantity   = parseInt(quantitySpan.textContent);

    plusBtn.addEventListener("click", () => {
      quantity++;
      quantitySpan.textContent = quantity;
      totalTd.textContent      = `₹${(unitPrice * quantity).toFixed(2)}`;
      updateTotalAmount();
    });

    minusBtn.addEventListener("click", () => {
      if (quantity > 1) {
        quantity--;
        quantitySpan.textContent = quantity;
        totalTd.textContent      = `₹${(unitPrice * quantity).toFixed(2)}`;
        updateTotalAmount();
      }
    });
  });
}

function updateTotalAmount() {
    let total = 0;
    document.querySelectorAll(".cart-table tbody tr").forEach(row => {
        const totalCell = row.children[5];
        if (!totalCell) return;

        const totalText = totalCell.textContent.replace("₹", "").trim();
        const totalValue = parseFloat(totalText);
        if (!isNaN(totalValue)) {
            total += totalValue;
        }
    });

    // Update subtotal and total amount
    const subtotalEl = document.querySelector(".cost span");
    const totalAmountEl = document.querySelector(".summary h3");

    if (subtotalEl) {
        subtotalEl.textContent = `₹${total.toFixed(2)}`;
    }
    if (totalAmountEl) {
        totalAmountEl.textContent = `Total Amount: ₹${total.toFixed(2)}`;
    }
}


document.addEventListener("DOMContentLoaded", () => {
    attachQuantityHandlers();
});

</script>