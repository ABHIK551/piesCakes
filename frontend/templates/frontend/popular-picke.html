<section class="popular-picks">
    <!-- Left Banner Section -->
    <div class="popular-left" id="popularItem">
        <img id="popularImage" src="" alt="Bestselling treat">
        <div class="popular-text">
            <h2 id="popularHeading">...</h2>
            <a href="#" id="popularLink" class="shop-btn">Shop Now</a>
        </div>
    </div>

    <!-- Right Content Section -->
    <div class="popular-right">
        <div class="popular-category">
            <h2>Trending <span>Cakes</span><b>< ></b></h2>
            <div class="items" id="trending-container">
                <div class="item">
                    <img src="https://s3-alpha-sig.figma.com/img/ef04/3dbb/2b7cccec16c019ce86a585e7241463b7?Expires=1743984000&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=oxwn~~fbTXVM6tR4kDbk0y9T2uPccwaqFWvptUM3671mU2jfiaqFmiFvUEru84difGsFj0z5Yk75dZz-qxnZuCl-872T6y-i-zsSNaLq3jpQPtTzUKpuoY0vU4JwATsgjyJY14H37XtoBW619jCGXVr1FIEr~qdVmcoiJ2~k4alSlOjf18YYl1vPQa96hFYO3zDQUO7vEzbyY7VKWybV5N5e36OCXWba6MNCO-WeYpPzfFAryEwXL-Z5XlqLTIngxQSJOnrUQ-D5O-JscLIRkWXWM9rxSIgglTjf0fhxqH7Fhgi0F1C1Bw5laBX-V7etQ27xIhe4Ry0oOGQtV1kfkg__" alt="French Vanilla Bomboloni">
                    <div class="item-info">
                        <h4>FRENCH VANILLA BOMBOLONI</h4>
                        <p>Desserts</p>
                        <span>₹200.00</span>
                    </div>
                </div>
                <div class="item">
                    <img src="https://s3-alpha-sig.figma.com/img/a9ef/cf1b/07b1fafcc9d898239ef020f47f3bcd90?Expires=1743984000&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=WbrbvzGoEcckyB4lsVBmnyhtiycURWhgOJEdtjT~Fn3z1QDuLfv12qCqHEj4U5xWaBszWcN5xzzPfGT0Fg44aa9xffUr0ONUTc~LGvJKC2~SAPBPkcvSM8rztArOHlX-Kbix4gqNnRIe7glHfs~R9iU5ynYxYFWhh~xucAGBjVDCuu02qizEMNG~9e8uaqsfgg-7HTeZggAialSe0otQ~w2bAapNdCFClP0Mazrd3bRyMacSCrM~hK7IiBKi6exaYyqejLLjW4A6juhAtCeAw4yTbZyrxnWgal1gfCPktipJ2izXgPk17Sb1aUHYBKbW7W7x4oSZKH9wsrp-j6L5nw__" alt="Red Velvet">
                    <div class="item-info">
                        <h4>RED VELVET</h4>
                        <p>Cake</p>
                        <span>₹700.00</span>
                    </div>
                </div>
                <div class="item">
                    <img src="https://s3-alpha-sig.figma.com/img/f9b3/0e57/78ef8132c44847533f3a6134ad7b20cb?Expires=1743984000&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=tmlr90JZn1PUWbP4pdKhY4HyPEht6v6LK9sfsf0DY~BqWaiK-BFNS1H66iOUM-t5yzQY4Etme5Rm8XY3C3dGcsnj3vomN72WcKVyq0keGEVS~p0vI1a1S3-Hw64IIam7HQf08gWN9G18-NQ-Zhq-v5yAn9DzAQ~iOPXcXpkRcjs14jV-4sFqQYc4rF1q4NbX8M17yfH4mZUBxB~7uv3ewvW5N04PjDUUQvhDFwtWyOMyw7aTq10qXFUzedDiuaISCtcdoSTYBaXbBfP5iFFtbq6ZIMXIr9KmNRa4LDHh-ib86Ky1Gd7DzPAEtqdEHl~nV6pPXIg0kaI~NMNZDmi7GA__" alt="Biscoff Brownies">
                    <div class="item-info">
                        <h4>BISCOFF BROWNIES</h4>
                        <p>Desserts</p>
                        <span>₹150.00</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="popular-category">
            <h2>Top <span>Rated</span><b style="float: right;"><></b></h2>
            <div class="items" id="top-rated-container">
                <div class="item">
                    <img src="https://s3-alpha-sig.figma.com/img/45a5/b7c7/495c436c36424bfee5a0384fa68331fa?Expires=1743984000&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=U722uvO6m2nGkHsuUKJgkCWgxXB0XoAi8XWdF1ah6BzvNjs7CNUDP4HGMdzzJA~IBk5qu08zHKz-~fuUYXOWmb0THQ8UeSYplo7NrggBlF9qhfK9hlGOhoKAk0sxuo1ZEnoXOd0NBahJUFa9NVCCBRowH7w8sDSp2C4yzxP1CBZq8IO5PsHwkQo9EKiHhxh3PSmsknu62-mZfb0WlvTYrHpyxoMDHOBYDqV3uh3Ff~pc07cpNUzMjATPKh6H6iI-ZsSLvkvkoyOkKV6UdG-AVDy5uOh5H3gabxxvor9ykTkwk68z6kO8MLMVDJ6eBthY5~-O81hBUDWFCKxSyCgRog__" alt="Blueberry Cheesecake">
                    <div class="item-info">
                        <h4>BLUEBERRY CHEESE CAKE</h4>
                        <p>Cakes</p>
                        <span>₹200.00</span>
                    </div>
                </div>
                <div class="item">
                    <img src="https://s3-alpha-sig.figma.com/img/6ecd/8944/d2f2cc6ae3dd16cb9a679827cc4e221d?Expires=1743984000&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=kodG507OmboiztTvt0h1wVYiNWsRVCVisCpQgLbIjTyRLvbunLdPDAG5Psyj745oT1j211CLyNCb2Owh0hERs1Bi9VCuf-z87XzYz8cBM-~mSpLUzyKsvnsGWjZgmvL9w5bUW0pWU9GUoGRjxZ1DpHHwPeKQmLaHIKt0pWqWI5DuIHnbAdNghe3FmDm~1DipjZs5mid~hH97veQgAmg18rPIz9EgLqPrGkk9vFJBhPKBlnZI06VpJlfXjFnwmltv9SjlMN8XM76HwsvpQkYIJeRg1NFuGI2KlqmGMBMZx610168TJrhScigwJKgUOQD752aoNGaeklyh6bUF1mfJxQ__" alt="Tandoori Veggie Sandwich">
                    <div class="item-info">
                        <h4>TANDOORI VEGGIE SANDWICH</h4>
                        <p>Snacks</p>
                        <span>₹150.00</span>
                    </div>
                </div>
                <div class="item">
                    <img src="https://s3-alpha-sig.figma.com/img/8858/3ff8/f78492380cd2d687ad0d23afeb0d5a70?Expires=1743984000&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=OXOICYGTZTuqhuIdRG94Rk3SxbHj0DoQ3puckuun4RWgwlSovvImN~mln7yM8xAOWlygySeiqHQVQQ7KV~Oe~L3or-tj7CADpaBWFRuWW3i6e-UAYoADRARLGbWyVWHxjoBQ8~KvmajmrNU5BTlhGTex1L-eR780DLma2oUWpY7rmNOZze4rfOp1fovGEcJmH4aZRveYYk1Zsek9Q6YHCkA~2h6AHs-3Diuc-PPAIPDDtbKmZBtiMlJWQpi9Qwa6ujaTETGBW4zh9cblxXOGrItwNkz39zXo3dY4Rt5AdjS8iiSx1JFNQFtc618JSXT2E6iPouk5gbYmFJL1LhHa~g__" alt="Double Chocolate Cupcake">
                    <div class="item-info">
                        <h4>DOUBLE CHOCOLATE CUP CAKE</h4>
                        <p>Cupcakes & Muffins</p>
                        <span>₹70.00</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="popular-category">
            <h2>Top <span>Selling</span><b style="float: right;"><></b></h2>
            <div class="items" id="top-selling-container">
                <div class="item">
                    <img src="https://s3-alpha-sig.figma.com/img/8a20/53cf/69326bca05412c52363c504c81ab5637?Expires=1743984000&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=aYu7k6eAbTePJMDyO8-Te5TpukXJkl2sA1vnbYfvX4Z0IH6sja2100hd4NpeOAmNf3ZrXK2CNUDLu7rOqAJGJmHffPJW8pJz~gmdDZ0Fovqv-d4uJVxmbxSJ1oMNpFfgbXPwG9ZnIeiEDVNoogzmWYEu0QK6ckWoDNlSzJi2GsH7ztRJsC5Tbcmww7bgJxmauJkuEFyJCIgsnz4iU0SVQk8eo~gfbo8yV26RmFD9NuSNqEobDVOLPe3RrL1xZYmhHpJ4lyNYhKSD6ohp~QHg7nhdaFo4v09iJsAhTKrrL3V~o79hqw2swYg08Wb4KcdmVwTlIxh4NSdASzyNw32GgQ__" alt="Classic Hot Chocolate">
                    <div class="item-info">
                        <h4>CLASSIC HOT CHOCOLATE</h4>
                        <p>Beverages</p>
                        <span>₹180.00</span>
                    </div>
                </div>
                <div class="item">
                    <img src="https://s3-alpha-sig.figma.com/img/d30b/301d/a8fa63ad1559462e999dba9001fb3a98?Expires=1743984000&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=XzwKi~LpSMxbyG8U6So9bdfBiK~m-lj0-l~sjpSWVvR1SdXdNEwzM8dm7p1ytfcyuvUz23j3j1YlIHL9zU-4PIDI2zCfcbMRE0VFjN5LlUrvKSZOYm~GcZu4XZtFtat1x8t0qVPKfjiilggP16RIzTIm56rPf~0EFFY5PZvQCGFQ6cjr7XfdOfRBSCd4ao2sKIRUCPixC0x3z69N-rM6TWNx1sbqK-9Id0GGJXuodrXDcMmCBkfocTCm3BMs-04YtaYxCM9-9hOi0S1nZ20nRg3Y5Gdj-U6sIQdvz6xVi9M5MnGne4ufoAVclr7Iq2dS~PT-IueACFgIpf9j2GQ4Vw__" alt="Almond Bliss Croissant">
                    <div class="item-info">
                        <h4>ALMOND BLISS CROISSANT</h4>
                        <p>Croissant</p>
                        <span>₹180.00</span>
                    </div>
                </div>
                <div class="item">
                    <img src="https://s3-alpha-sig.figma.com/img/7ac0/a2b9/b87624ca58abbb10b9652be486be152f?Expires=1743984000&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=CIvtl-iluhbzxJ8Ey3qgiSYWLB3-mDVVRsev96V4WUkIKlhnO4BnBbBXZH~2C8sfJ8hPu7yMtE78KoMfTeQAiU7ld56g5X-3u9WPBF0mt3xLVpb6yOwupdGaa-ynSrz-~EKjKSdJ~zAva9TI6AiHZzUoeBuElzaCM6BTcWwcn7gRo90lBrRQb3Q09tpwK1lmE5DNoJm0MWfd3LVEk8V-VWlh1GiZ71DzZw4Op1MhLHTIJOTF90qSE9noPNqsox7T~a-d9bsxm3tZNWXbeHlrx-uxvM68FAYFWuvzNF0uVIFk4Cr4vZV8M02wSZRSJSmx-mZZM5WdjwdeD0y1KzbLcQ__" alt="Chocolate Hazelnut Delight">
                    <div class="item-info">
                        <h4>CHOCOLATE HAZELNUT DELIGHT</h4>
                        <p>Croissant</p>
                        <span>₹180.00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    async function fetchAndRenderProducts() {
    try {
        const res = await fetch('http://127.0.0.1:8000/api/products-list/?page=1&pageSize=100');
        const data = await res.json();

        // Access the products array from the nested structure
        const products = data.products.products;

        // Filter and sort as needed
        const trendingCakes = products
            .filter(p => p.category.name === 'Cakes')
            .sort((a, b) => b.id - a.id) // You can use your own logic
            .slice(0, 2);

        const topRated = products
            .sort((a, b) => b.total_sales - a.total_sales) // Replace with rating if available
            .slice(0, 2);

        const topSelling = products
            .sort((a, b) => b.total_sales - a.total_sales)
            .slice(0, 2);

        renderItems(trendingCakes, 'trending-container');
        renderItems(topRated, 'top-rated-container');
        renderItems(topSelling, 'top-selling-container');

    } catch (err) {
        console.error('Error fetching products:', err);
    }
}

function renderItems(items, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';

    items.forEach(product => {
        const price = product.discount_price || product.price;
        const imageSrc = `data:image/jpeg;base64,${product.product_images}`;

        const itemHTML = `
            <div class="item">
                <img src="${imageSrc}" alt="${product.name}" />
                <div class="item-info">
                    <h4>${product.name}</h4>
                    <p>${product.category.name}</p>
                    <span> ₹${product.discount_price ? (product.price - product.discount_price).toFixed(2) : product.price.toFixed(2)}
                                    ${product.discount_price ? `<strike>₹${product.price.toFixed(2)}</strike>` : ''}</span>
                </div>
            </div>
        `;
        container.innerHTML += itemHTML;
    });
}

document.addEventListener('DOMContentLoaded', fetchAndRenderProducts);

</script>
<script>
    function loadPopularItem() {
        const token = sessionStorage.getItem("auth_token");

        if (!token) {
            redirectToLogin();
            return;
        }

        fetch('http://127.0.0.1:8000/api/top-pick-background/list/?page=1&pageSize=5', {
            method: 'GET',
            headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
            }
        })
        .then(response => {
            if (response.status === 401) {
                redirectToLogin();
                return;
            }
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }
            return response.json();
        })
        .then(data => {
            const activeItem = data.data?.find(item => item.status === "1"); // status is a string
            console.log("Active item:", activeItem);

            if (activeItem) {
                document.getElementById("popularImage").src = activeItem.image;
                document.getElementById("popularHeading").textContent = activeItem.heading;
                document.getElementById("popularLink").href = activeItem.link || "#";
            }
        })
        .catch(error => {
            console.error("Failed to load popular item:", error);
        });
    }

    document.addEventListener("DOMContentLoaded", loadPopularItem);
</script>
