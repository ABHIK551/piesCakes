<section class="categories" id="categories">
    <div class="categories-wrapper">
        <h2><span>Our</span> Categories</h2>
        <div class="category-container">
            <div class="category">
                <img src="https://s3-alpha-sig.figma.com/img/e641/97c9/272a9b555cab1e960f10880d7587518d?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=YqFAqVGlONOmv16CkTNPtCAhBlJ3YitW7cmXQyAz2R-Mg8UcAA3lRWD3Jaeqx9enzFApnh1I5QnN1d33P-nA~aupqMG8JZTCUAHtF02vl21YCebUkeQazqwaZ8xCqAZGdd~UkjIp4Bu~QUcqqceb-u-MULkGZvk6T4aVb7W7HLiJpy3~UZxrhzsQvywZmhnoMr-fGQEOGr5slOcfldpc8cnMAyhtXEktg5-dhl7cK2NrshNmpptCEkLyomyCeRhfXz3tgSYc4bYftEoEny4baqdkio96aVt~fiqWN3VQfePaDYGDCPdOPbcG3ONDFUZcFwjArcVIUi0kwkFSUmqLYw__" alt="Cakes">
                <p>Cakes</p>
            </div>
            <div class="category">
                <img src="https://s3-alpha-sig.figma.com/img/5658/ad6d/dad5188b95c8380128b09e52c6f52e5a?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=maASYuQ-26S0mGqKgQKk~Mo9wITVwsRwrMEXkCJjwyQDbCkJbU1lSUuRcs1A9X0OyjSOSthT4uZTKm71pMAus6RE0iG3iFiLvIpGvyZfRKAx0q9UcYhA2UtTAujY1VHyZvsLq7m~DPPJmYSxmyyw3lGAemsgu3r7TMsiCPPk7Ty1KfzdHkltoeUJKtppKWGqbByS4y8VtkfHGNn3D12ZPe6dU87w9bCoTnzNV6x~WbpUjDv3v1qNqu8u0aYzBgMzKpOEiE4iRK-Hm~F9DuIbr-0DCKZv6JgJAGtHyCLmaS3gH29EM55Vv5XPoWBThttzeuOPcFz9SrKdPCJRrygPxA__" alt="Cupcakes & Muffins">
                <p>Cupcakes & Muffins</p>
            </div>
            <div class="category">
                <img src="https://s3-alpha-sig.figma.com/img/21b3/1fa6/b145657cbf9b269b4c79dd7cd630aaca?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=frLs2S8nTw6ZoOWjzoG0Djvp9DCl7OMk7XSd5bGXptoYOQHCrpoBCjLP-du~y2IIqG22VaaTztjMaNrlo7U~Gk~JrCFP5pq1QQQEoelrAwYJeB2bgvbgC2g8J0XLP0ODx0Sr0aqh6vw8pdEbB7JYOVbGI66VqFS1fELBe7ANhJDSXYlLJirUDx3cGSiFraL3pWrMlvfxEZ-okxVltpb7Pl7eQInhElo9CaO4t-WOnLlHdlpkf1snogQ37xHD~8s88KQrquK4X5NBT3YwwVzf4onAWn0UxKfbh1AoF0scshC85oQoX9mQcAKw6cb~5J4Gk6ZGqjRtr5tax30iCTLEqA__" alt="Pies & Tarts">
                <p>Pies & Tarts</p>
            </div>
            <div class="category">
                <img src="https://s3-alpha-sig.figma.com/img/7a41/e1df/d58e8b4923be2857ab3b2642b662052f?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=kvqtBSjjXZLIjELAWRxaVkDj~JQXk6FLs9zXKmyfaDhdA6gM4NoVwKES2WGdBKJMgUmsbcVp6xKzZ8NX3-k20wyo0F91RCjM7WAbnBy9n2yQsjk2-ZJtMBJSdyPluTcAcJhIXtKaG-idfW~28J99-mNo3~ftKByEoGFPd45HS66s9XtZXEW0qVZfxz3zUGhByMG9wVFWyD0xKS3cY~RmbhH-r73RimLLk-ztJ7OMtIulNQG9TNBgkCRu5hs~NHwnVUjwRN4OlY9f1wa27-X5VXgUV9mBZQBb4aHnGK-dikHq~kokCyRqQbaoeMvQ~drYjWPwFXvyZ80pxIOB4pSOWA__" alt="Desserts">
                <p>Desserts</p>
            </div>
            <div class="category">
                <img src="https://s3-alpha-sig.figma.com/img/0a44/ee0a/a1de038822e3c6f7ee61d63f607afcb4?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=Z-m5crtk4sCfBPmh5jKGt-ClPbWET5mXEEzZaDBpbwIJ384IhwqB9c0MgfzK121RInRctZ2tZpTF4KYJiF4Cgy53Xgg8CB4N-coMbIlR8brRq406hWiGy-bxVyrzfTCyWak2lTm4PRjsjLPWiVNi2aTuKJ1eCrqf2kFrt68LG6JQbY~9q4gVHynYyL17oxQBwRFHKa1I2Uu6BexaeapCGTjftiTqQpMs3CBuqFb5Bt0YdYAtxY3j5CsXKZNMW5vfjjIKIcXj80L2euwlGyqMwz0FRB~YQAMOEy4H3CI0bxG0uKNEP8xZu79k7ahdUxQss9anK1N5aOo2hGh4VTcJUA__" alt="Croissants">
                <p>Croissants</p>
            </div>
            <div class="category">
                <img src="https://s3-alpha-sig.figma.com/img/d4a6/844d/2d29e78b426b2fd3509f86820b4d003a?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=GUx40wMXSA-yrNANov5WadNYzyUe9tiUrgG9NZGxo8Y~CJ7Ba~9Uw0XT~~PGpB5lYmyebyq5K5~H8k2MI6xw9GFY9inGyvIgrl9QC7VNUz1abT6QFqXfAnlKLTfuMoJd0wFGwAGbhy6y9Pqi7sWe1gh82iyw5bW-PQJIL3LfBdx~eJMiFoZ9G0WkwdFaw3mKG5T~RIyKtOgJxD8YQM26XZLQMMopkcIMgwBcbAT5mngAc-QRN4conuDmnTqB8yYEGnHkPWvSApisXGRdsGSjnh9nLOiXluH9bSoLZEpnA9IQkO6bBcN9diyWk0pzlqnfk77nlmXrwd-eSIoorWgU~g__" alt="Snacks">
                <p>Snacks</p>
            </div>
            <div class="category">
                <img src="https://s3-alpha-sig.figma.com/img/7ca8/c324/5bfeb2b671b649d90e94fb4f33ff32f7?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=beSWJF-VxRy1XXxFQkJU6SfUHL5dG8MwRsjPlJmQ-H8uCmYZ5dninBrWB8B0o5FHcnSNUPJC7bFxr-Xnzy7-oZmU-u78U6cyQIBGEIvWXHrikLntquCkvTmEVPTKRZsEkYTiacxzG8M3AT~Gy6OUHfUXEmWrQK9d03Y6Xfb7ToC2RpOpKV~G5MOysGdwZe2dOU9xuf7eyAG0r9OOKesN~H0yFgS2OKbT3TCdVTHoKEpRPd4rEK32UdtcIn2SEi-JrQdVHIWl8THsA2J4FAiNnSnYszHIeWUVNHXHvYh2UMwrh5stutcPRl6Xh-TuOcY9DcQfQlsGSKxzdE4qQq3wCw__" alt="Food Menu">
                <p>Food Menu</p>
            </div>
            <div class="category">
                <img src="https://s3-alpha-sig.figma.com/img/3927/a721/eb9e483bce368ad19e6837c124be5215?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=tO~8tvd6NenvillgBRHYEsS97R0drhATWCjwbAvon9uaB-rBYv685AJMI3jaoxHDpTNdfW43xgGTFC2pR8B3YqnCB3WUFLENd51x1xmI60etLTZdsq~wbH8LwujsWHBGFbiiRRGg94AQxQKVF2X18Q6I9P4dw0f2rPnyCHiz33e86gBqAADDURdsb4SD07Ppvvruwm8JHIDrzx32hz4fd67RaKRdSjqLIohKY3AdjU3eiA21RJDCT0XeyXaVEGA2lGmgT~2UfkvCdo1EMlRoT5E-39eurRKI-igZil2mVO7nj63V1EBKw1TCw2qZHwRZC-t3rceiLuvAK3Rk3i~ITA__" alt="Beverages">
                <p>Beverages</p>
            </div>
        </div>
    </div>
</section>
<script>
   document.addEventListener("DOMContentLoaded", function () {
    fetchCategories();
});

function fetchCategories() {
    const token = sessionStorage.getItem("auth_token"); // Or use localStorage

    if (!token) {
        redirectToLogin();  // Token is missing, redirect to login
        return;
    }

    fetch("/api/categories-list/", {
        method: "GET",
        headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
        }
    })
    .then(response => {
        if (response.status === 401) {
            redirectToLogin();  // Unauthorized access, redirect to login
            return;
        }

        if (!response.ok) {
            throw new Error("Network response was not ok");
        }
        return response.json();
    })
    .then(data => {
        if (data.success && data.categories && data.categories.main_categories) {
            renderCategories(data.categories.main_categories);
        } else {
            console.error("Invalid category data structure");
        }
    })
    .catch(error => {
        console.error("Error fetching categories:", error);
    });
}

function renderCategories(categories) {
    const section = document.querySelector("section.categories");
    if (!section) {
        console.error("Categories section not found!");
        return;
    }

    const container = section.querySelector(".category-container");
    if (!container) {
        console.error("Category container not found inside .categories section!");
        return;
    }

    container.innerHTML = ""; // Clear existing content

    categories
        .filter(category => category.status === 1)
        .forEach(category => {
            const categoryDiv = document.createElement("div");
            categoryDiv.classList.add("category");

            console.log("Loading category:", category.name);

            const imageSrc = category.image
                ? `data:image/png;base64,${category.image}`
                : "default-image.jpg";

            // Assuming `category.slug` exists; fallback to `category.id` if not
            const link = `/category`;

            categoryDiv.innerHTML = `
                <a href="${link}" style="text-decoration:none">
                    <img src="${imageSrc}" alt="${category.name}">
                    <p>${category.name}</p>
                </a>
            `;

            container.appendChild(categoryDiv);
        });
}


function redirectToLogin() {
    window.location.href = "/login";
}
</script>


