<section class="bestsellers">
    <div class="bestsellers-wrapper">
        <h2><span>Our</span> Bestsellers</h2>
        <p>Don't wait. The time will never be just right.</p>

        <!-- Swiper Slider -->
        <div class="swiper bestsellers-slider">
            <div class="swiper-wrapper">
                <!-- Product 1 -->
                <div class="swiper-slide product bestseller-product">
                    <div class="product-image">
                        <img src="https://s3-alpha-sig.figma.com/img/862d/44e0/061e29c6e50f12618b0ba34042f3fd79?Expires=1743379200&Key-Pair-Id=APKAQ4GOSFWCW27IBOMQ&Signature=cG-mcU7qlmsC6EH3ElXgE0f-8-RUKi7-HLfx8lxLgViTNAyNU3-0q9cywKfziETo5pwYcuDbxETJQGpeqwTDmqbH003CUDfQhjr7yWnHS-HuHIbxJDWNEW6xPk6ZdWWKQ~CtXFsn4rzhWkvGSifZgMJZ6gLN8S5eL6W28eduUDcPoV1NrQjgFReX9f0Q8TGrtJCzZdhMiKcJ~Zj3mOO7KCJiKGmmzFcUgY~CzLFfrwWgNJpF3cBlt7Od8EVfRB14yPeXMfFQmTXJRF1Oq5pGIXWsDGOShaQQWXrotf8J2Uym0SKXwVRTQmOFQz-yqeuPrtHBRpJ9iSB-mRNa83AttA__" alt="Triple Chocolate Mousse Cake">
                        <span class="badge sale">SALE</span>
                    </div>
                    <div class="product-info">
                        <p class="category">Cakes</p>
                        <h3>TRIPLE CHOCOLATE MOUSSE CAKE</h3>
                        <div class="rating">⭐⭐⭐⭐☆</div>
                        <p class="price">₹260.00</p>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>

            <!-- Pagination Dots -->
            <div class="swiper-pagination"></div>
        </div>
    </div>
</section>

<script>
    function loadBestsellers() {
        fetch(`http://127.0.0.1:8000/api/products-list/?page=1&pageSize=100`)
            .then(response => response.json())
            .then(data => {
                const allProducts = data.products.products;
    
                // Normalize reviews and sort by number of reviews (assume it's an array or number)
                const sorted = allProducts
                    .map(p => {
                        const reviewCount = Array.isArray(p.reviews) ? p.reviews.length : (parseInt(p.reviews) || 0);
                        return { ...p, reviewCount };
                    })
                    .sort((a, b) => b.reviewCount - a.reviewCount)
                    .slice(0, 10); // Top 10 only
    
                const wrapper = document.querySelector('.bestsellers-slider .swiper-wrapper');
                wrapper.innerHTML = ''; // Clear current slides
    
                sorted.forEach(product => {
                    const badgeLabel = product.reviewCount > 50 ? 'HOT' : (product.reviewCount > 20 ? 'TRENDING' : '');
                    const badgeHTML = badgeLabel ? `<span class="badge sale">${badgeLabel}</span>` : '';
                    const category = product.category ? product.category.name : 'Unknown';
                    const rating = '⭐'.repeat(Math.min(5, Math.floor(product.reviewCount / 10))) + '☆'.repeat(5 - Math.min(5, Math.floor(product.reviewCount / 10)));
                        
                    const slide = `
                        <div class="swiper-slide product bestseller-product">
                            <div class="product-image">
                                <img src="data:image/png;base64,${product.product_images}" alt="${product.name}">
                                ${badgeHTML}
                            </div>
                            <div class="product-info">
                                <p class="category">${category}</p>
                                <h3>${product.name}</h3>
                                <div class="rating">${rating}</div>
                                <p class="price">
                                    ₹${product.discount_price ? (product.price - product.discount_price).toFixed(2) : product.price.toFixed(2)}
                                    ${product.discount_price ? `<strike>₹${product.price.toFixed(2)}</strike>` : ''}
                                </p>                           
                            </div>
                        </div>
                    `;
                    wrapper.innerHTML += slide;
                });
            })
            .catch(error => {
                console.error('Error loading bestsellers:', error);
            });
    }
    
    document.addEventListener('DOMContentLoaded', loadBestsellers);
    </script>
    
