<section class="new-arrivals">
    <div class="new-arrivals-header">
        <div class="header-left">
            <h2 class="section-title"><span>New</span> Arrivals</h2>
            <p class="section-subtitle">Shop online for new arrivals and get free shipping!</p>
        </div>
    
        <div class="header-right">
            <div class="category-filters" id="category-container">
                <ul>
                    <li class="active">All</li>
                </ul>
            </div>
        </div>
    </div>
    

    <div class="product-grid" id="products-container">

    </div>
</section>
        <!-- <script>
        document.addEventListener("DOMContentLoaded", async function () {
            try {
                const response = await fetch("http://127.0.0.1:8000/api/products-list/");
                const data = await response.json();
                const products = data.products.products;
        
                const categoryContainer = document.getElementById("category-container");
                const productsContainer = document.getElementById("products-container");
        
                // Function to display products
                function displayProducts(productList) {
                    productsContainer.innerHTML = "";
                    if (productList.length === 0) {
                        productsContainer.innerHTML = "<p>No products found</p>";
                        return;
                    }
        
                    productList.forEach(product => {
                        const productElement = document.createElement("div");
                        const discountedPrice = product.discount_price ? product.price - product.discount_price : product.price;
        
                        productElement.classList.add("product-card");
                        productElement.innerHTML = `
                            <img src="data:image/png;base64,${product.product_images || 'placeholder.jpg'}" alt="${product.name}" />
                            <div class="product-info">
                                <span class="category">${product.category.name}</span>
                                <h3>${product.name}</h3>
                                <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div> 
                                <p class="price">
                                    ‚Çπ${discountedPrice}
                                    ${product.discount_price ? `<strike>‚Çπ${product.price}</strike>` : ''}
                                </p>
                                <span class="badge new">NEW</span>
                            </div>
                        `;
                        productsContainer.appendChild(productElement);
                    });
                }
        
                function filterProducts(category) {
                    if (category === "All") {
                        displayProducts(products);
                    } else {
                        const filteredProducts = products.filter(product => product.category.name === category);
                        displayProducts(filteredProducts);
                    }
                }
        
                categoryContainer.addEventListener("click", function (event) {
                    if (event.target.tagName === "LI") {
                        const selectedCategory = event.target.innerText.trim();
                        document.querySelectorAll("#category-container li").forEach(li => li.classList.remove("active"));
                        event.target.classList.add("active");
                        filterProducts(selectedCategory);
                    }
                });
                displayProducts(products);
            } catch (error) {
                console.error("Error fetching products:", error);
            }
        });
        </script> -->
<script>
document.addEventListener("DOMContentLoaded", async function () {
    try {
        const response = await fetch("/api/products-list/?page=1&pageSize=1000", {
            method: "GET",
        });
        
        const data = await response.json();
        const products = data.products.products;

        const categoryContainer = document.getElementById("category-container");
        const productsContainer = document.getElementById("products-container");

        // Extract unique categories from products
        const uniqueCategories = ["All", ...new Set(products.map(product => product.category.name))];

        // Generate category filters dynamically
        categoryContainer.innerHTML = `<ul>${uniqueCategories.map(cat => `<li>${cat}</li>`).join("")}</ul>`;

        // Ensure "All" is active by default
        const categoryItems = categoryContainer.querySelectorAll("li");
        if (categoryItems.length) {
            categoryItems[0].classList.add("active");
        }

        function encodeProductId(id) {
            // Convert ID to string, pad or salt it if you want a longer encoded result
            const padded = `${id}-piescakes`;
            return btoa(padded);
        }

        // Function to display products
        function displayProducts(productList) {
            productsContainer.innerHTML = "";
            if (productList.length === 0) {
                productsContainer.innerHTML = "<p>No products found</p>";
                return;
            }

            productList.forEach(product => {
                const productElement = document.createElement("div");
                const discountedPrice = product.discount_price ? product.price - product.discount_price : product.price;

                // Convert product created_at date to JavaScript Date object
                const createdAt = new Date(product.created_at);
                const currentDate = new Date();

                // Calculate the difference in days
                const timeDifference = currentDate - createdAt;
                const daysDifference = timeDifference / (1000 * 60 * 60 * 24);

                // Check if the product is within the last 10 days
                const isNew = daysDifference <= 10;

                const encodedId = encodeProductId(product.id); // üîê encoded ID

                productElement.classList.add("product-card");
                productElement.innerHTML = `<div class="inner-product-tag" style="border-radius:0px;text-align: left !important;">
                        <a href="product/${encodedId}"><img src="data:image/png;base64,${product.product_images || 'placeholder.jpg'}" alt="${product.name}" loading="lazy"/></a>
                        <div class="product-info">
                            <span class="category mb-1" style="text-align: left !important;">${product.category.name}</span>
                            
                            <h4 class="mb-1 product-heading"><a href="product/${encodedId}" style="
                                text-decoration:none;
                                font-size: 14px !important;
                                text-decoration: none !important;
                                font-weight: bold;
                                text-align: left !important;
                                color: #5A3E36;
                                margin: 0;
                            ">${product.name}</a></h4>
                            
                            <div cls="rating mb-1">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                            
                            <p class="price mb-1">
                                ‚Çπ${discountedPrice}
                                ${product.discount_price ? `<strike>‚Çπ${product.price}</strike>` : ''}
                            </p class="badge">

                            ${isNew ? `<spans>NEW</span>` : ''}
                        </div>
                    </div>
                `;

                productsContainer.appendChild(productElement);
            });
            initMobileSwiper();
        }

        // Function to filter products by category
        function filterProducts(category) {
            if (category === "All") {
                displayProducts(products);
            } else {
                const filteredProducts = products.filter(product => product.category.name === category);
                displayProducts(filteredProducts);
                
            }
        }

        // Event delegation for category selection
        categoryContainer.addEventListener("click", function (event) {
            if (event.target.tagName === "LI") {
                const selectedCategory = event.target.innerText.trim();

                // Remove "active" class from all categories
                document.querySelectorAll("#category-container li").forEach(li => li.classList.remove("active"));
                
                // Add "active" class to the clicked category
                event.target.classList.add("active");

                // Filter products based on selected category
                filterProducts(selectedCategory);
            }
        });

        // Display all products by default
        displayProducts(products);
    } catch (error) {
        console.error("Error fetching products:", error);
    }
});

        </script>
        <script>

            function forceStyle(element, property, value) {
                element.style.setProperty(property, value, "important");
            }
            
            let mobileSwiper = null;
            
            function initMobileSwiper() {
                const container = document.getElementById('products-container');
                const cards = Array.from(container.querySelectorAll('.product-card'));
            
                if (window.innerWidth <= 468 && cards.length > 0) {
                    container.classList.add('swiper');
            
                    // Only create wrapper if not exists
                    if (!container.querySelector('.swiper-wrapper')) {
                        const wrapper = document.createElement('div');
                        wrapper.classList.add('swiper-wrapper');
            
                        // Move cards into wrapper
                        cards.forEach(card => {
                            card.classList.add('swiper-slide');
                            wrapper.appendChild(card);
                        });
            
                        // Clear container and append wrapper
                        container.innerHTML = '';
                        container.appendChild(wrapper);
            
                        // (optional) add pagination div if you want dots
                        const pagination = document.createElement('div');
                        pagination.classList.add('swiper-pagination');
                        container.appendChild(pagination);
                    }
            
                    // Initialize Swiper
                    if (!mobileSwiper) {
                        mobileSwiper = new Swiper("#products-container", {
                            slidesPerView: 1,
                            centeredSlides: true,        // center the slide nicely
                            spaceBetween: 0,    
                            loop: true,
                            autoplay: {
                                delay: 3000,
                                disableOnInteraction: false,
                            },
                            pagination: {
                                el: ".swiper-pagination",
                                clickable: true,
                            },
                            navigation: {
                                nextEl: ".swiper-button-next",
                                prevEl: ".swiper-button-prev",
                            },
                        });
                    }
                }
            }
            
            </script>
            
    </div>
</section>
